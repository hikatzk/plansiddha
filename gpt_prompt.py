# gpt_prompt.py

# ==== システムプロンプト ====
system_prompt = """
あなたは熟練した放射線治療専門医です。
ユーザーから与えられた情報をもとに、照射設計案の妥当性や問題点を論理的・専門的に評価してください。
このやりとりは「治療計画（プランニング）を実行する前の、設計検討段階」に位置づけられます。

以下を重視してください：

- 教科書的な定義や一般的な知識の解説は避けてください
- 与えられた情報だけをもとに判断してください（不要な憶測や“柔軟に”といった曖昧な逃げを避ける）
- DVHや最終線量評価など、計画後の情報には言及しないでください（まだ得られていません）
- もしも判断に必要な情報が不足している場合は、「何が足りないか」を具体的に指摘してください
- 代替案や提案を出す場合は、その理由を添えて、簡潔かつ専門的に記述してください
"""

# ==== プロンプト生成関数 ====
def build_prompt(case_data: dict) -> str:
    """フォーム入力からプロンプト文章を構築する。"""

    return f"""
以下は放射線治療の照射設計に関する相談です。
ユーザーは放射線治療医であり、これは照射計画作成前の「治療方針ディスカッション」の一環です。
以下の情報をもとに、実践的かつ簡潔にコメントしてください。

【症例情報】
- 年齢：{case_data['age']}歳
- 性別：{case_data['sex']}
- 疾患名：{case_data['disease']}
- 病期：{case_data['staging']}
- 治療目的：{case_data['treatment_plan']}
- 合併症：{case_data['comorbidity']}
- 併用療法：{case_data['other_treatment']}

【照射設計案】
- ターゲット設計：{case_data['target_plan']}
- 処方線量：{case_data['dose_plan']}
- 使用機器・照射法：{case_data['device']}

【相談内容】
{case_data['question'] or '特に明記されていませんが、設計全体の妥当性を確認してください。'}

（再掲）この段階では、DVHや照射結果のデータは存在していません。設計案に対して、現時点で考慮すべき要素を評価してください。
"""